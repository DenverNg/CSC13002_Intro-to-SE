<!DOCTYPE html>
<html lang="en">

<head>
	<title>SEBANK</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="/css/main.css">
	<script src="/js/func.js"></script>
	<link rel="stylesheet" href="/css/table.css">
	<!--JSPDF-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
	<script src="/js/table.js"></script>
	<link rel="stylesheet" href="/css/dropdown.css">
	<script src="/js/dropdown.js"></script>
	<link rel="stylesheet" href="/css/tab.css">
	<script src="/js/tab.js"></script>
	<link rel="stylesheet" href="/css/input_report.css">
	<script src="/js/input.js"></script>
	
	
	<!-- Linking Google Font Link for Icon -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
	<link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
</head>

<body>
	<div class="container">
		<aside class="sidebar" style="z-index: 99">
			<!-- Sidebar content -->
			<img src="/images/SEBank.png" alt="logo-hover" class="sidebar-img-default" />
			<img src="/images/Logo.png" alt="logo-hover" class="sidebar-img-hover" />
			<ul class="sidebar-links">
				<li data-content="Dashboard">
					<a href="/#">
						<span class="material-icons" style="font-size: 35px">
							home
						</span> Trang chủ
					</a>
				</li>
				<li data-content="Manage">
					<a href="/quan_ly_so#">
						<span class="material-icons" style="font-size: 35px">
							manage_search
						</span>Quản lý sổ
					</a>
				</li>
				<li>
					<a href="/bao_cao_ngay#">
						<span class="material-icons" style="font-size: 35px">
							description
						</span> Báo cáo
					</a>
				</li>
				<li>
					<a href="/cai_dat#">
						<span class="material-icons" style="font-size: 35px">
							settings
						</span> Cài đặt
					</a>
				</li>
			</ul>
		</aside>
		<div class="main">
			<div class="content">
				<!-- Tabs -->
				<div class="tabs">
					<div class="tab-item">
						<a href="/bao_cao_ngay">
							<i class="tab-icon fas fa-code"></i>
							Báo cáo doanh số
						</a>
					</div>
					<div class="tab-item active">
						<a href="/bao_cao_thang">
							<i class="tab-icon fas fa-cog"></i>
							Báo cáo đóng/mở
						</a>
					</div>
					<div class="line"></div>
				</div>

				<!-- Monthly Report Content -->
				<div class="tab-content">
					<div class="tab-pane active">
						<div class="topbar-report">
							Báo Cáo Đóng/Mở Hàng Tháng
						</div>
						<div class="subheader">
							<div class="EnterValue">
								<form action="/bao_cao_thang" method="POST">
								<div onclick="inputClicked({ id: 'input-date', inputType: 'month'})" id="input-date"
									class="form-group">
									<input id="date" name="date" class="form-group__input" type="month" value="<%= currentMonth %>" >
									<div class="form-group__title">Nhập tháng báo cáo</div>
									<!-- <span id="input-name-message" class="form-group__message"></span> -->
									<span id="selected-month" class="form-group__message"></span>
								</div>
								
								<!--Dropdown Select-->
								<div class="wrapper">
									<div class="select-btn">
										<span id="selected-type">Chọn loại kỳ hạn</span>
										<i class="uil uil-angle-down"></i>
									</div>
									<div class="select-content">
										<div class="select-search">
											<i class="uil uil-search"></i>
											<input spellcheck="false" type="text" placeholder="Tìm kiếm loại kỳ hạn">
										</div>
										<ul class="options"></ul>
									</div>
								</div>
								<div id="types">
									<input type="hidden" name="types" value="<%= types %>">
								</div>
								
								<input type="hidden" id="hidden-type" name="selectedType" value="<%= selectedType %>">

								<button type="submit" class="form-group__button submit-button" name="action" value="confirm">Xem báo
									cáo</button>
								</form>
							</div>
							<div class="Function">
								<div class="icon" id="download-daily">
									<span class="material-symbols-outlined" style="font-size: 40px">download</span>
									Tải báo cáo
								</div>
								<div class="icon" id="print-daily">
									<span class="material-icons" style="font-size: 40px">print</span>
									In báo cáo
								</div>
							</div>
						</div>
					
					<section class="table__body">
						<table id="Monthly-Report">
							<thead>
								<tr>
									<th> STT <span class="icon-arrow">&UpArrow;</span></th>
									<th> Ngày <span class="icon-arrow">&UpArrow;</span></th>
									<th> Sổ mở <span class="icon-arrow">&UpArrow;</span></th>
									<th> Sổ đóng <span class="icon-arrow">&UpArrow;</span></th>
									<th> Chênh lệch <span class="icon-arrow">&UpArrow;</span></th>
								</tr>
							</thead>
							<tbody>
								<% for (let i=0; i < listMonthlyRP.length; i++) { %>
									<tr>
										<td>
											<%=i+1%>
										</td>
										<td>
											<%=listMonthlyRP[i].NGAY%>
										</td>
										<td>
											<%= listMonthlyRP[i].SOMO %>
										</td>
										<td>
											<%= listMonthlyRP[i].SODONG %>
										</td>
										<% if (listMonthlyRP[i].CHENHLECH> 0) { %>
											<td>
												<p style="color: rgb(73, 155, 73);">
													<%=listMonthlyRP[i].CHENHLECH%>
												</p>
											</td>
											<% } else if (listMonthlyRP[i].CHENHLECH==0) { %>
												<td>
													<p style="color: black;">
														<%=listMonthlyRP[i].CHENHLECH%>
													</p>
												</td>
												<% } else { %>
													<td>
														<p style="color: red;">
															<%=listMonthlyRP[i].CHENHLECH%>
														</p>
													</td>
													<% } %>
									</tr>
									<% } %>
							</tbody>
						</table>
					</section>

					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- JavaScript to initialize the date input with the current month -->
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const dateInput = document.getElementById('date');
			const selectedMonthSpan = document.getElementById('selected-month');
			const currentMonth = "<%= currentMonth %>" // Set the input value to the current month
			if (currentMonth) {
				dateInput.value = currentMonth; // Đặt giá trị input là currentMonth
			} else {
				const now = new Date();
				const year = now.getFullYear();
				const month = ('0' + (now.getMonth() + 1)).slice(-2); // Tháng hiện tại với leading zero nếu cần
				dateInput.value = `${year}-${month}`; // Đặt giá trị input là tháng hiện tại
			}
			// Function to handle dropdown population
			const wrapper = document.querySelector(".wrapper"),
				selectBtn = wrapper.querySelector(".select-btn"),
				searchInp = wrapper.querySelector("input"),
				options = wrapper.querySelector(".options"),
				hiddenTypeInput = document.getElementById("hidden-type");

			//let types = ["Không kỳ hạn", "Kỳ hạn 3 tháng", "Kỳ hạn 6 tháng", "Kỳ hạn 8 tháng", "Kỳ hạn 10 tháng", "Kỳ hạn 12 tháng", "Kỳ hạn 16 tháng", "Kỳ hạn 20 tháng"]; // replace with actual types fetched from the server
			const types = "<%= types %>".split(","); // Get the types from the server-side variable	
			const selectedType = "<%= selectedType %>";
			
			function addType() {
				options.innerHTML = ""; // Clear the current options
				if (selectedType) {
					let li = `<li onclick="updateName(this)" class="selected">${selectedType}</li>`;
					options.insertAdjacentHTML("beforeend", li);
				}
				types.forEach(type => {
					if (type !== selectedType) {
						let li = `<li onclick="updateName(this)">${type}</li>`;
						options.insertAdjacentHTML("beforeend", li);
					}
				});
			}

			addType(); // Populate dropdown on page load
			const firstOption = options.querySelector('li');
			updateName(firstOption);

			function updateName(selectedLi) {
				searchInp.value = ""; // Clear search input
				addType(); // Refresh list with the selected type
				selectBtn.firstElementChild.innerText = selectedLi.innerText; // Update button text with selected type
				wrapper.classList.remove("active"); // Hide dropdown options after selection
				hiddenTypeInput.value = selectedLi.innerText; // Update hidden input value
			}

			searchInp.addEventListener("keyup", () => {
				let arr = [];
				let searchedVal = searchInp.value.toLowerCase();
				arr = types.filter(data => {
					return data.toLowerCase().includes(searchedVal); // Filter types based on search input
				}).map(data => {
					let isSelected = data == selectBtn.firstElementChild.innerText ? "selected" : "";
					return `<li onclick="updateName(this)" class="${isSelected}">${data}</li>`;
				}).join("");
				options.innerHTML = arr ? arr : `<p style="margin-top: 10px;">Không tìm thấy loại kỳ hạn nào</p>`; // Update dropdown with filtered list or message if no match
			});

			selectBtn.addEventListener("click", () => wrapper.classList.toggle("active")); // Toggle dropdown visibility
			
			options.addEventListener('click', (event) => {
				if (event.target.tagName === 'LI') {
					updateName(event.target);
				}
			})
		});
	</script>

</body>

</html>
