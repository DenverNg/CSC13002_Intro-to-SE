
GO
use SEBANK


# Delete table
DROP TABLE IF EXISTS DONVI_TOITHIEU;
DROP TABLE IF EXISTS PHIEUGUITIEN;
DROP TABLE IF EXISTS PHIEURUTTIEN;
DROP TABLE IF EXISTS SOTIETKIEM;
DROP TABLE IF EXISTS LOAI_SOTK;
DROP TABLE IF EXISTS KHACHHANG;

# Delete procedure
DROP PROCEDURE IF EXISTS MOSOTIETKIEM;
DROP PROCEDURE IF EXISTS LAPPHIEUGUI;
DROP PROCEDURE IF EXISTS LAPPHIEURUT;
DROP PROCEDURE IF EXISTS TRACUUSO;
DROP PROCEDURE IF EXISTS BAOCAO_NGAY;
DROP PROCEDURE IF EXISTS BAOCAO_THANG;

# Create Table
CREATE TABLE KHACHHANG (
	MAKH INT PRIMARY KEY,
	HOTEN NVARCHAR(100),
	DIACHI NVARCHAR(100),
	CMND CHAR(12) UNIQUE
);
CREATE TABLE LOAI_SOTK (
	MALOAI INT PRIMARY KEY,
	KYHAN NCHAR(20),
	LAISUAT FLOAT,
	TRANGTHAI INT
);
CREATE TABLE SOTIETKIEM (
	MASO CHAR(8) PRIMARY KEY,
	MAKH INT,
	SODU INT,
	LOAI INT, 
	NGAYMOSO DATE, 
	TRANGTHAI INT,
	NGAYDONGSO DATE
);
CREATE TABLE PHIEUGUITIEN(
	MAPHIEUGUI INT PRIMARY KEY,
	MASO CHAR(8), 
	NGAYGUI DATE,
	SOTIEN INT,
	MAKH INT
);
CREATE TABLE PHIEURUTTIEN(
	MAPHIEURUT INT PRIMARY KEY,
	MASO CHAR(8), 
	NGAYRUT DATE,
	SOTIEN INT,
	TIENLAI INT,
	MAKH INT
);
CREATE TABLE DONVI_TOITHIEU(
	TEN CHAR(10) PRIMARY KEY,
	GIATRI INT
);
-- TẠO KHOÁ NGOẠI
ALTER TABLE SOTIETKIEM
ADD CONSTRAINT FK_SOTK_KH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
ADD CONSTRAINT FK_SOTK_LOAI FOREIGN KEY (LOAI) REFERENCES LOAI_SOTK(MALOAI);

ALTER TABLE PHIEUGUITIEN
ADD CONSTRAINT FK_PHIEUGUI_KH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
ADD CONSTRAINT FK_PHIEUGUI_STK FOREIGN KEY (MASO) REFERENCES SOTIETKIEM(MASO);

ALTER TABLE PHIEURUTTIEN
ADD CONSTRAINT FK_PHIEURUT_KH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
ADD CONSTRAINT FK_PHIEURUT_STK FOREIGN KEY (MASO) REFERENCES SOTIETKIEM(MASO);

-- Thêm các loại tiết kiệm
INSERT INTO LOAI_SOTK (MALOAI, KYHAN, LAISUAT, TRANGTHAI)
VALUES
    (0, 'KHÔNG KỲ HẠN', 0.0015, 1),
    (3, 'KỲ HẠN 3 THÁNG', 0.005, 1),
    (6, 'KỲ HẠN 6 THÁNG', 0.0055, 1);

-- Thêm các đơn vị tối thiểu
INSERT INTO DONVI_TOITHIEU (TEN, GIATRI)
VALUES
    ('SOTIENGUI', 100000),
    ('THOIGIAN',  15);

DELIMITER //

CREATE FUNCTION TAO_MASO()
RETURNS CHAR(8)
BEGIN
    DECLARE new_maso CHAR(8);
    DECLARE current_max CHAR(8);

    -- Lấy mã số lớn nhất hiện có
    SELECT MAX(MASO) INTO current_max FROM SOTIETKIEM;

    -- Nếu không có mã số nào, bắt đầu từ 'MS000000'
    IF current_max IS NULL THEN
        SET new_maso = 'MS000000';
    ELSE
        -- Tăng mã số hiện tại và định dạng lại
        SET new_maso = CONCAT(
            'MS', 
            LPAD(CAST(SUBSTRING(current_max, 3) AS UNSIGNED) + 1, 6, '0')
        );
    END IF;

    RETURN new_maso;
END //

DELIMITER ;

DELIMITER //

CREATE PROCEDURE MOSOTIETKIEM(
    IN p_LOAITK INT,
    IN p_TENKH NVARCHAR(100),
    IN p_CMND CHAR(12),
    IN p_DIACHI NVARCHAR(100),
    IN p_NGAYMOSO DATE,
    IN p_SOTIEN INT
)
BEGIN
    DECLARE v_MAKH INT;
    DECLARE v_MASO CHAR(8);
    DECLARE v_min_amount INT;

    -- KIỂM TRA TÍNH HỢP LỆ
    IF p_LOAITK NOT IN (SELECT MALOAI FROM LOAI_SOTK) THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Loại tiết kiệm không hợp lệ';
    END IF;

    IF p_NGAYMOSO < CURDATE() THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Ngày mở sổ không hợp lệ';
    END IF;

    SELECT GIATRI INTO v_min_amount FROM DONVI_TOITHIEU WHERE TEN = 'SOTIENGUI';
    IF p_SOTIEN < v_min_amount THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Số tiền gửi không hợp lệ';
    END IF;

    -- Cập nhật bảng KHÁCH HÀNG
    IF p_CMND NOT IN (SELECT CMND FROM KHACHHANG) THEN
        IF NOT EXISTS (SELECT 1 FROM KHACHHANG) THEN
            SET v_MAKH = 0;
        ELSE
            SELECT MAX(MAKH) + 1 INTO v_MAKH FROM KHACHHANG;
        END IF;
        INSERT INTO KHACHHANG (MAKH, HOTEN, DIACHI, CMND) VALUES (v_MAKH, p_TENKH, p_DIACHI, p_CMND);
    ELSE
        SELECT MAKH INTO v_MAKH FROM KHACHHANG WHERE CMND = p_CMND;
    END IF;

    -- Cập nhật bảng SỔ TIẾT KIỆM
    SET v_MASO = TAO_MASO();
    INSERT INTO SOTIETKIEM (MASO, MAKH, SODU, LOAI, NGAYMOSO, TRANGTHAI) VALUES (v_MASO, v_MAKH, p_SOTIEN, p_LOAITK, p_NGAYMOSO, 1);

    -- Kết thúc thủ tục
END //

DELIMITER ;
GO
DELIMITER //

CREATE PROCEDURE LAPPHIEUGUI(
    IN p_MASO CHAR(8),
    IN p_NGAYGUI DATE,
    IN p_SOTIEN INT
)
BEGIN
    DECLARE v_LOAITK INT;
    DECLARE v_MAPHIEUGUI INT;

    -- KIỂM TRA TÍNH HỢP LỆ
    IF NOT EXISTS (SELECT 1 FROM SOTIETKIEM WHERE MASO = p_MASO AND TRANGTHAI = 1) THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Mã sổ không hợp lệ';
    END IF;

    SELECT LOAI INTO v_LOAITK FROM SOTIETKIEM WHERE MASO = p_MASO;
    IF v_LOAITK != 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Loại tiết kiệm không hợp lệ';
    END IF;

    IF p_NGAYGUI < CURDATE() - INTERVAL 1 DAY THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Ngày gửi tiền không hợp lệ';
    END IF;

    IF p_SOTIEN < (SELECT GIATRI FROM DONVI_TOITHIEU WHERE TEN = 'SOTIENGUI') THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Số tiền gửi không hợp lệ';
    END IF;

    -- Xác định mã phiếu gửi
    SELECT COALESCE(MAX(MAPHIEUGUI), 0) + 1 INTO v_MAPHIEUGUI FROM PHIEUGUITIEN;

    INSERT INTO PHIEUGUITIEN (MAPHIEUGUI, MASO, NGAYGUI, SOTIEN) VALUES (v_MAPHIEUGUI, p_MASO, p_NGAYGUI, p_SOTIEN);
    
    UPDATE SOTIETKIEM
    SET SODU = SODU + p_SOTIEN
    WHERE MASO = p_MASO;
END //

DELIMITER ;

DELIMITER //

CREATE PROCEDURE LAPPHIEURUT(
    IN p_MASO CHAR(8),
    IN p_NGAYRUT DATE,
    IN p_SOTIEN INT
)
BEGIN
    DECLARE v_NGAYMOSO DATE;
    DECLARE v_LOAITK INT;
    DECLARE v_THOIGIANGUI INT;
    DECLARE v_TIENLAI DECIMAL(15, 2);
    DECLARE v_MAPHIEURUT INT;
    DECLARE v_SOLANDAOHAN INT;

    -- KIỂM TRA TÍNH HỢP LỆ
    IF NOT EXISTS (SELECT 1 FROM SOTIETKIEM WHERE MASO = p_MASO AND TRANGTHAI = 1) THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Mã sổ không hợp lệ';
    END IF;

    IF p_NGAYRUT < CURDATE() - INTERVAL 1 DAY THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Ngày rút tiền không hợp lệ';
    END IF;

    SELECT NGAYMOSO INTO v_NGAYMOSO FROM SOTIETKIEM WHERE MASO = p_MASO;
    IF DATEDIFF(p_NGAYRUT, v_NGAYMOSO) < (SELECT GIATRI FROM DONVI_TOITHIEU WHERE TEN = 'THOIGIAN') THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Chưa đủ thời gian gửi tối thiểu';
    END IF;

    SET v_THOIGIANGUI = TIMESTAMPDIFF(MONTH, v_NGAYMOSO, p_NGAYRUT);
    IF DATE_ADD(v_NGAYMOSO, INTERVAL v_THOIGIANGUI MONTH) > p_NGAYRUT THEN
        SET v_THOIGIANGUI = v_THOIGIANGUI - 1;
    END IF;

    SELECT LOAI INTO v_LOAITK FROM SOTIETKIEM WHERE MASO = p_MASO;

    -- Xác định mã phiếu rút
    SELECT COALESCE(MAX(MAPHIEURUT), 0) + 1 INTO v_MAPHIEURUT FROM PHIEURUTTIEN;

    IF v_LOAITK = 0 AND p_SOTIEN <= (SELECT SODU FROM SOTIETKIEM WHERE MASO = p_MASO) THEN
        IF v_THOIGIANGUI >= 1 THEN
            SET v_TIENLAI = (SELECT LAISUAT FROM LOAI_SOTK WHERE MALOAI = v_LOAITK) * p_SOTIEN;
        ELSE
            SET v_TIENLAI = 0;
        END IF;
        INSERT INTO PHIEURUTTIEN (MAPHIEURUT, MASO, NGAYRUT, SOTIEN, TIENLAI) VALUES (v_MAPHIEURUT, p_MASO, p_NGAYRUT, p_SOTIEN, v_TIENLAI);
    ELSEIF v_LOAITK != 0 AND p_SOTIEN = (SELECT SODU FROM SOTIETKIEM WHERE MASO = p_MASO) THEN
        SET v_SOLANDAOHAN = FLOOR(v_THOIGIANGUI / v_LOAITK);
        IF v_SOLANDAOHAN >= 1 THEN
	        SET v_TIENLAI = (SELECT LAISUAT FROM LOAI_SOTK WHERE MALOAI = v_LOAITK) * p_SOTIEN * v_SOLANDAOHAN;
	        INSERT INTO PHIEURUTTIEN (MAPHIEURUT, MASO, NGAYRUT, SOTIEN, TIENLAI) VALUES (v_MAPHIEURUT, p_MASO, p_NGAYRUT, p_SOTIEN, v_TIENLAI);
	    ELSE
	    	SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Chưa đủ thời gian đáo hạn';
	   	END IF;
    ELSE
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Rút tiền không thành công';
    END IF;

    UPDATE SOTIETKIEM
    SET SODU = SODU - p_SOTIEN
    WHERE MASO = p_MASO;

    UPDATE SOTIETKIEM
    SET TRANGTHAI = 0, NGAYDONGSO = p_NGAYRUT
    WHERE SODU = 0;
END //

DELIMITER ;
DELIMITER //

CREATE PROCEDURE TRACUUSO(
    IN p_INPUT NVARCHAR(100)
)
BEGIN
    SELECT 
        STK.MASO, 
        L.KYHAN,  
        KH.HOTEN, 
        STK.SODU, 
        STK.TRANGTHAI
    FROM 
        SOTIETKIEM STK
    JOIN 
        KHACHHANG KH ON KH.MAKH = STK.MAKH
    JOIN 
        LOAI_SOTK L ON L.MALOAI = STK.LOAI
    WHERE 
        p_INPUT = KH.CMND OR 
        p_INPUT = STK.MASO OR 
        KH.HOTEN LIKE CONCAT('%', p_INPUT, '%');
END //

DELIMITER ;
--Báo cáo hoạt động ngày
DELIMITER //

CREATE PROCEDURE BAOCAO_NGAY(
    IN p_NGAY DATE
)
BEGIN
    SELECT 
        L.KYHAN, 
        COALESCE(TONGTHU.TONGTHU, 0) AS TONGTHU, 
        COALESCE(TONGCHI.TONGCHI, 0) AS TONGCHI, 
        COALESCE(TONGTHU.TONGTHU, 0) - COALESCE(TONGCHI.TONGCHI, 0) AS CHENHLECH
    FROM 
        LOAI_SOTK L 
    LEFT JOIN 
        (SELECT 
            S.LOAI, 
            SUM(PGT.SOTIEN) AS TONGTHU
         FROM 
            PHIEUGUITIEN PGT
         JOIN 
            SOTIETKIEM S ON PGT.MASO = S.MASO
         WHERE 
            p_NGAY = PGT.NGAYGUI
         GROUP BY 
            S.LOAI
        ) AS TONGTHU ON L.MALOAI = TONGTHU.LOAI 
    LEFT JOIN 
        (SELECT 
            S.LOAI, 
            SUM(PRT.SOTIEN) AS TONGCHI
         FROM 
            PHIEURUTTIEN PRT
         JOIN 
            SOTIETKIEM S ON PRT.MASO = S.MASO
         WHERE 
            p_NGAY = PRT.NGAYRUT
         GROUP BY 
            S.LOAI
        ) AS TONGCHI ON L.MALOAI = TONGCHI.LOAI;
END //

DELIMITER ;

--Báo cáo tháng
DELIMITER //

CREATE PROCEDURE BAOCAO_THANG(IN THANG INT, IN TENKYHAN NCHAR(20))
BEGIN
	DECLARE NAM INT DEFAULT YEAR(CURDATE());
	DECLARE LOAI INT;
	DECLARE SONGAYTRONGTHANG INT;
	SET SONGAYTRONGTHANG = DAY(LAST_DAY(CONCAT(NAM, '-',THANG,'-01')));
	SELECT MALOAI INTO LOAI FROM LOAI_SOTK WHERE TENKYHAN = KYHAN;
   	SELECT THANG, NAM, LOAI;
      CREATE TEMPORARY TABLE NGAYTRONGTHANG (
	    num INT
	);
	INSERT INTO NGAYTRONGTHANG (num)
	SELECT @rownum := @rownum + 1 AS num
	FROM information_schema.columns a, information_schema.columns b, (SELECT @rownum := 0) r
	LIMIT SONGAYTRONGTHANG;
   
	 -- Tạo bảng tạm để lưu kết quả từ các subquery
	CREATE TEMPORARY TABLE BANGSOMO AS
	SELECT N.num, S.NGAYMOSO, COUNT(S.MASO) as SOMO
	FROM NGAYTRONGTHANG N
	LEFT JOIN SOTIETKIEM S ON S.LOAI = LOAI 
	    AND MONTH(S.NGAYMOSO) = THANG 
	    AND YEAR(S.NGAYMOSO) = NAM 
	    AND N.num = DAY(S.NGAYMOSO) 
	    AND S.TRANGTHAI = 1
	GROUP BY N.num, S.NGAYMOSO;
	
	CREATE TEMPORARY TABLE BANGSODONG AS
	SELECT N2.num, S2.NGAYDONGSO, COUNT(S2.MASO) as SODONG
	FROM NGAYTRONGTHANG N2
	LEFT JOIN SOTIETKIEM S2 ON S2.LOAI = LOAI 
	    AND MONTH(S2.NGAYDONGSO) = THANG 
	    AND YEAR(S2.NGAYDONGSO) = NAM
	    AND N2.num = DAY(S2.NGAYDONGSO) 
	    AND S2.TRANGTHAI = 0
	GROUP BY N2.num, S2.NGAYDONGSO;
	
	SELECT * FROM BANGSOMO;
	SELECT * FROM BANGSODONG;
	
	
	-- Thực hiện phép nối giữa các bảng tạm
	SELECT CONCAT(BANGSOMO.NUM, THANG, NAM) AS NGAY, BANGSOMO.SOMO, BANGSODONG.SODONG, BANGSOMO.SOMO - BANGSODONG.SODONG AS CHENHLECH
	FROM BANGSOMO
	JOIN BANGSODONG ON BANGSOMO.num = BANGSODONG.num;
	
	-- Xóa các bảng tạm sau khi sử dụng
	DROP TEMPORARY TABLE BANGSOMO;
	DROP TEMPORARY TABLE BANGSODONG;
	DROP TEMPORARY TABLE NGAYTRONGTHANG;
END //
DELIMITER ;


--DATA
CALL MOSOTIETKIEM(3, 'Nguyễn Thị Như Quỳnh', '680040861383', 'Q6', '2024-08-29', 324123);
CALL MOSOTIETKIEM(0, 'Lê Hoàng Quân', '195829997176', 'Q9', '2024-08-26', 365799);
CALL MOSOTIETKIEM(0, 'Đinh Văn Phượng', '388020211268', 'Thủ Đức', '2024-09-14', 280362);
CALL MOSOTIETKIEM(6, 'Nguyễn Echam Samuel', '658045667834', 'Q2', '2024-12-13', 864882);
CALL MOSOTIETKIEM(6, 'Nguyễn Xuân Sang', '825203284988', 'Bình Thạnh', '2024-04-06', 799866);
CALL MOSOTIETKIEM(0, 'Lê Phú Quý', '498268225956', 'Q11', '2024-10-01', 925962);
CALL MOSOTIETKIEM(3, 'Lý Quốc Quyền', '312827054412', 'Q4', '2024-10-04', 512666);
CALL MOSOTIETKIEM(0, 'Bùi Minh Quân', '945433296608', 'Q10', '2024-12-25', 752544);
CALL MOSOTIETKIEM(0, 'Nguyễn Ngọc Sơn', '451774613213', 'Bình Thạnh', '2024-04-10', 985706);
CALL MOSOTIETKIEM(3, 'Bùi Duy Qúy', '512789311506', 'Bình Tân', '2024-02-15', 541337);
CALL MOSOTIETKIEM(0, 'Võ Hoàng Phương', '568008021671', 'Q12', '2024-06-25', 550721);
CALL MOSOTIETKIEM(6, 'Trần Minh Phương', '719515296739', 'Q11', '2024-11-09', 679312);
CALL MOSOTIETKIEM(3, 'Phan Duy Quốc', '247228165684', 'Q3', '2024-03-27', 929324);
CALL MOSOTIETKIEM(6, 'Nguyễn Vũ Ngọc Quyên', '130789159079', 'Q8', '2024-08-21', 347620);
CALL MOSOTIETKIEM(6, 'Trương Trọng Quân', '619792323830', 'Q5', '2024-06-13', 854163);
CALL MOSOTIETKIEM(6, 'Phạm Minh Quân', '680373619622', 'Q10', '2024-08-21', 247553);
CALL MOSOTIETKIEM(6, 'Võ Thanh Sanh', '161921817644', 'Q11', '2024-01-31', 903552);
CALL MOSOTIETKIEM(6, 'Nguyễn Minh Phương', '379601139479', 'Tân Bình', '2024-07-22', 465240);
CALL MOSOTIETKIEM(3, 'Nguyễn Viết Sơn', '197071075953', 'Q2', '2024-06-14', 206462);
CALL MOSOTIETKIEM(3, 'Vũ Hoàng Hải Sơn', '717892076834', 'Thủ Đức', '2024-07-07', 289746);
CALL MOSOTIETKIEM(3, 'Nguyễn Hải Sơn', '386144925360', 'Q4', '2024-04-25', 288307);
CALL MOSOTIETKIEM(0, 'Nguyễn Vũ Trường Sơn', '448992847473', 'Thủ Đức', '2024-07-23', 237864);
CALL MOSOTIETKIEM(3, 'Trần Minh Sang', '972690561259', 'Q8', '2024-03-24', 689164);
CALL MOSOTIETKIEM(3, 'Nguyễn Trung Sơn', '487498608510', 'Thủ Đức', '2024-06-05', 711350);
CALL MOSOTIETKIEM(0, 'Lê Quang', '873755210891', 'Q5', '2024-09-30', 891871);
CALL MOSOTIETKIEM(6, 'Vũ Thị Phương', '201481640487', 'Q9', '2024-07-12', 664573);
CALL MOSOTIETKIEM(3, 'Nguyễn Văn Sơn', '270410546138', 'Tân Bình', '2024-09-17', 165672);
CALL MOSOTIETKIEM(6, 'Lê Anh Sơn', '356226201974', 'Q6', '2024-09-07', 466478);
CALL MOSOTIETKIEM(3, 'Võ Tiến Sĩ', '829262601980', 'Bình Tân', '2024-02-24', 835411);
CALL MOSOTIETKIEM(3, 'Phan Đức Sơn', '346702690513', 'Q3', '2024-01-16', 662033);
CALL MOSOTIETKIEM(3, 'Trần Thế Sơn', '856677525141', 'Q4', '2024-04-30', 580141);
CALL MOSOTIETKIEM(0, 'Vũ Hồng Tâm', '406985439510', 'Q11', '2024-01-12', 982704);
CALL MOSOTIETKIEM(3, 'Nguyễn Minh Tân', '633084916794', 'Q4', '2024-03-15', 187575);
CALL MOSOTIETKIEM(0, 'Lê Hà Xuân Thái', '781953253460', 'Q5', '2024-07-21', 414564);
CALL MOSOTIETKIEM(0, 'Nguyễn Ngọc Phương', '965247472786', 'Q6', '2024-12-23', 307828);
CALL MOSOTIETKIEM(0, 'Bùi Anh Tài', '475778333366', 'Q7', '2024-07-11', 838889);
CALL MOSOTIETKIEM(0, 'Dương Chí Tâm', '246186261124', 'Thủ Đức', '2024-01-26', 203976);
CALL MOSOTIETKIEM(6, 'Phạm Thanh Quốc', '418159844790', 'Thủ Đức', '2024-12-18', 406027);
CALL MOSOTIETKIEM(3, 'Lê Trường Sa', '144148770935', 'Thủ Đức', '2024-07-13', 691051);
CALL MOSOTIETKIEM(3, 'Lưu Nguyễn Quốc Sơn', '811929283997', 'Q10', '2024-10-24', 765337);
CALL MOSOTIETKIEM(0, 'Ngô Vũ Sang', '252899128711', 'Q3', '2024-04-13', 913649);
CALL MOSOTIETKIEM(6, 'Lê Công Tài', '079872959226', 'Q2', '2024-06-27', 785618);
CALL MOSOTIETKIEM(6, 'Đỗ Minh Tâm', '360313719902', 'Q6', '2024-09-02', 631048);
CALL MOSOTIETKIEM(3, 'Trần Thị Minh Sương', '533601667453', 'Q5', '2024-06-27', 134566);
CALL MOSOTIETKIEM(6, 'Trần Văn Tài', '817423072613', 'Q2', '2024-07-10', 705005);
CALL MOSOTIETKIEM(0, 'Lê Văn Tài', '494951366447', 'Q4', '2024-04-03', 689615);
CALL MOSOTIETKIEM(6, 'Vũ Thị Hoài Sơn', '420673069546', 'Bình Thạnh', '2024-10-18', 245047);
CALL MOSOTIETKIEM(6, 'Dương Thanh Tâm', '056327305507', 'Q6', '2024-09-30', 834948);
CALL MOSOTIETKIEM(0, 'Hồ Quốc Tài', '517465473970', 'Q2', '2024-09-14', 537655);
CALL MOSOTIETKIEM(0, 'Huỳnh Lê Tấn Tài', '069695986792', 'Q9', '2024-12-09', 687255);
CALL MOSOTIETKIEM(3, 'Huỳnh Hữu Tâm', '169997173359', 'Q5', '2024-08-04', 907467);
CALL MOSOTIETKIEM(0, 'Nguyễn Anh Tấn', '051708998671', 'Q9', '2024-08-05', 540281);
CALL MOSOTIETKIEM(0, 'Nguyễn Ngọc Thân', '996271697822', 'Q4', '2024-10-19', 912943);
CALL MOSOTIETKIEM(0, 'Đoàn Thanh Tân', '175761347456', 'Q11', '2024-07-29', 928792);
CALL MOSOTIETKIEM(6, 'Vũ Minh Thái', '291367673047', 'Bình Tân', '2024-08-24', 894400);
CALL MOSOTIETKIEM(6, 'Đặng Xuân Thanh', '640120978064', 'Q12', '2024-10-18', 887651);
CALL MOSOTIETKIEM(0, 'Vũ Văn Thành', '016962001910', 'Bình Thạnh', '2024-08-18', 298360);
CALL MOSOTIETKIEM(0, 'Lê Duy Thắng', '556313698041', 'Thủ Đức', '2024-06-05', 531547);
CALL MOSOTIETKIEM(0, 'Hồ Nguyễn Xuân Thanh', '598713315449', 'Q9', '2024-12-25', 547597);
CALL MOSOTIETKIEM(0, 'Trần Tất Thắng', '209070159525', 'Q7', '2024-04-28', 444316);
CALL MOSOTIETKIEM(0, 'Nguyễn Chí Thanh', '442916902137', 'Bình Tân', '2024-04-04', 884045);
CALL MOSOTIETKIEM(3, 'Phan Xuân Thắng', '300505548597', 'Q5', '2024-02-22', 595669);
CALL MOSOTIETKIEM(3, 'Bùi Minh Thảo', '635318711944', 'Q10', '2024-07-28', 498159);
CALL MOSOTIETKIEM(0, 'Đặng Văn Thắng', '904687093280', 'Q1', '2024-08-09', 419291);
CALL MOSOTIETKIEM(0, 'Diệp Vương Thắng', '099135273470', 'Q12', '2024-07-03', 347165);
CALL MOSOTIETKIEM(3, 'Đinh Xuân Thắng', '732558274162', 'Q2', '2024-03-18', 753898);
CALL MOSOTIETKIEM(3, 'Lâm Văn Thành', '072835325527', 'Q2', '2024-03-17', 292989);
CALL MOSOTIETKIEM(3, 'Nguyễn Tiến Thành', '620268273132', 'Q5', '2024-01-10', 571280);
CALL MOSOTIETKIEM(6, 'Đàm Văn Thiện', '395475080594', 'Q11', '2024-07-12', 953614);
CALL MOSOTIETKIEM(3, 'Nguyễn Văn Thanh', '362432254279', 'Bình Tân', '2024-01-25', 978946);
CALL MOSOTIETKIEM(0, 'Võ Đức Thảo', '404353857042', 'Thủ Đức', '2024-02-07', 137500);
CALL MOSOTIETKIEM(3, 'Bùi Trung Thành', '509377938036', 'Bình Tân', '2024-05-04', 743754);
CALL MOSOTIETKIEM(3, 'Lê Tấn Thạnh', '775463413064', 'Q4', '2024-07-24', 399530);
CALL MOSOTIETKIEM(6, 'Lê Tiến Thành', '957662154291', 'Q10', '2024-02-03', 963498);
CALL MOSOTIETKIEM(6, 'Nguyễn Đình Thi', '885721848382', 'Q9', '2024-01-11', 844335);
CALL MOSOTIETKIEM(0, 'Nguyễn Công Thành', '207899820392', 'Q4', '2024-05-26', 213531);
CALL MOSOTIETKIEM(3, 'Lương Văn Thao', '378893811163', 'Q5', '2024-01-14', 846851);
CALL MOSOTIETKIEM(3, 'Cao Bá Thành', '902323433739', 'Bình Thạnh', '2024-05-11', 722652);
CALL MOSOTIETKIEM(0, 'Nguyễn Hữu Thế', '728369225678', 'Q4', '2024-07-30', 891473);
CALL MOSOTIETKIEM(3, 'Đào Văn Thiện', '558233609883', 'Q3', '2024-09-14', 716094);
CALL MOSOTIETKIEM(3, 'Nguyễn Văn Thịnh', '578918443957', 'Q2', '2024-05-17', 345705);
CALL MOSOTIETKIEM(6, 'Nguyễn Đức Thông', '353907875156', 'Q9', '2024-02-15', 436028);
CALL MOSOTIETKIEM(3, 'Nguyễn Lê Trường Thọ', '732963652285', 'Q3', '2024-09-30', 816634);
CALL MOSOTIETKIEM(6, 'Trần Minh Thông', '946715906001', 'Bình Tân', '2024-11-22', 498028);
CALL MOSOTIETKIEM(6, 'Phạm Quang Thông', '244285586710', 'Q5', '2024-02-04', 242339);
CALL MOSOTIETKIEM(6, 'Trịnh Đức Thiện', '745211798236', 'Thủ Đức', '2024-04-09', 441797);
CALL MOSOTIETKIEM(6, 'Hồ Quang Thịnh', '175349640714', 'Q5', '2024-01-16', 219336);
CALL MOSOTIETKIEM(0, 'Trần Quang Văn Thư', '871554569328', 'Thủ Đức', '2024-03-06', 117542);
CALL MOSOTIETKIEM(0, 'Nguyễn Ngọc Hoài Thu', '527349560441', 'Bình Tân', '2024-10-08', 558675);
CALL MOSOTIETKIEM(0, 'Nguyễn Bỉnh Khiêm', '897148289531', 'Bình Tân', '2024-11-19', 553161);
CALL MOSOTIETKIEM(0, 'Huỳnh Thị Kim Sinh', '159693445759', 'Bình Thạnh', '2024-01-10', 112908);
CALL MOSOTIETKIEM(6, 'Lê Ngọc Thuận', '026769833236', 'Q10', '2024-09-23', 784824);
CALL MOSOTIETKIEM(3, 'Huỳnh Trần Thư', '984869498415', 'Q8', '2024-05-29', 614492);
CALL MOSOTIETKIEM(6, 'Phạm Thị Thanh Thuý', '263111068966', 'Q4', '2024-01-11', 502853);
CALL MOSOTIETKIEM(0, 'Nguyễn Hồng Thông', '393975817160', 'Thủ Đức', '2024-09-10', 508556);
CALL MOSOTIETKIEM(0, 'Nguyễn Cao Trường', '622376789568', 'Bình Tân', '2024-09-24', 227308);
CALL MOSOTIETKIEM(3, 'Phạm Công Thưởng', '390162550604', 'Q10', '2024-04-07', 100368);
CALL MOSOTIETKIEM(6, 'Phan Khánh Thuận', '630514373925', 'Q6', '2024-05-20', 648342);
CALL MOSOTIETKIEM(0, 'Trần Văn Dö', '104887199118', 'Bình Tân', '2024-06-15', 839871);
CALL MOSOTIETKIEM(6, 'Nguyễn Đình Lê Thuần', '659939314275', 'Q9', '2024-04-02', 972879);

--TEST
CALL MOSOTIETKIEM(3, 'Cường', '1234', 'aBC', '2024-08-22', 1000000);
CALL MOSOTIETKIEM(0, 'Anh', '22082004', 'aAC', '2024-08-20', 1000000);
CALL MOSOTIETKIEM(0, 'CƯỜNG', '523123', 'aC', '2024-09-30', 1000000);
CALL LAPPHIEUGUI('MS000002', '2024-09-06', 500000);
CALL LAPPHIEURUT('MS000000', '2024-12-18', 1000000);
CALL LAPPHIEURUT('MS000001', '2025-08-20', 500000);
CALL TRACUUSO('CƯỜNG');
CALL BAOCAO_NGAY('2024-10-18');
CALL BAOCAO_THANG(8, 'KỲ HẠN 3 THÁNG');



SHOW PROCEDURE STATUS WHERE Db = 'SEBANK';
SELECT * FROM DONVI_TOITHIEU
SELECT * FROM LOAI_SOTK
SELECT * FROM KHACHHANG
SELECT * FROM SOTIETKIEM
SELECT * FROM PHIEUGUITIEN
SELECT * FROM PHIEURUTTIEN